extends ../layout

block scripts
  script(src="/public/scripts/index.js") 
  script.
    const data ={ features: !{JSON.stringify(geoData).replace(/<\//g, "<\\/")}} 
    const mapTilerApiKey = '#{mapTilerApiKey}';
  script(src="/public/scripts/mapLibreGL.js" defer)
  link(rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma-carousel@4.0.3/dist/css/bulma-carousel.min.css")
  script(src='https://cdn.jsdelivr.net/npm/bulma-carousel@4.0.3/dist/js/bulma-carousel.min.js')
  
  
block content
  a(href='/campgrounds') All campgrounds
  .campground
    <div id='map' style='width: 100%; height: 300px;'></div>
    div(id="carousel" class="carousel" style='width: 70%;')
      each image, index in campground.images
        figure(class=`item-${index} image is-4by3` )
          img(style="object-fit: cover" src=image.url, alt=campground.title+"image")
    h1=campground.title 
    p=campground.description
    if currentUser && (currentUser.id === campground.author)
      form(class="hide", action="/campgrounds/"+campground.id+"?_method=PATCH", method="POST")
        input(type="text", name="title", value=campground.title)
        input(type="text", name="description",value=campground.description)
        input(type="number", name="price",value=campground.price)
        input(type="text", name="location[properties][name]",value=campground.location.properties.name)
        input(type="number", name="location[geometry][coordinates][]",value=campground.location.geometry.coordinates[0])
        input(type="number",name="location[geometry][coordinates][]",value=campground.location.geometry.coordinates[1])
        button(type="submit") Edit
      
      form(action="/campgrounds/"+campground.id+"?_method=DELETE", method="POST")
        button(type="submit") Delete
  .reviews 
    if currentUser
      form(class="hide", action="/campgrounds/"+campground.id+"/reviews", method="POST")
        input(type="textarea", name="details", value=campground.details)
        input(type="range", min=1, max=5, name="rating",value=campground.rating)
        button(type="submit") Submit Review
    each review in reviews
      .review.card
        h3.card-header=review.author.email 
        .card-content
          p=review.rating 
          p=review.details
        if currentUser && review.author.id === currentUser.id
          form(class="hide", action="/campgrounds/"+campground.id+"/reviews/"+review.id+"?_method=DELETE", method="POST")
            button(type="submit") Delete Review
          form(class="hide", action="/campgrounds/"+campground.id+"/reviews/"+review.id+"?_method=PATCH", method="POST")
            input(type="textarea", name="details", value=review.details)
            input(type="range", min=1, max=5, name="rating",step=1, value=review.rating)     
            button(type="submit") Edit
  script(defer="true").
    bulmaCarousel.attach('#carousel', {
          slidesToScroll: 1,
          slidesToShow: 1
        });    
  
    